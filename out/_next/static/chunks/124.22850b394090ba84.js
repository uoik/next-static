"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[124],{57124:function(e,t,r){r.r(t),r.d(t,{default:function(){return S}});var a,l,n,o,c,s,i,m=r(12648),w=r(16572),u=r(15072),f=r(77221),d=r(33092),p=r(6870);r(74964),r(2826);var h=r(244),g=r(21428),v=r.n(g),E=r(67554);function y(){return(y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}r(6004),r(91101),r(62808),r(15746),r(875),r(93932),r(32489),r(69537),r(45356),r(6096);var x=function(e){return h.createElement("svg",y({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 120 120"},e),a||(a=h.createElement("g",{filter:"url(#icon-map-no-result_svg__a)"},h.createElement("path",{fill:"url(#icon-map-no-result_svg__b)",d:"M13 101.302v-75.44a2 2 0 0 1 1.383-1.902l27.602-8.945a10 10 0 0 1 6.255.03l26.843 8.978a4 4 0 0 0 2.324.065l27.065-7.406a2 2 0 0 1 2.528 1.93v65.693a6 6 0 0 1-3.425 5.42L77.213 102.25a10.002 10.002 0 0 1-7.54.425L46.341 94.66a4 4 0 0 0-2.463-.045l-28.297 8.6A2 2 0 0 1 13 101.302Z"}),h.createElement("path",{stroke:"url(#icon-map-no-result_svg__c)",strokeLinejoin:"round",strokeWidth:1.5,d:"M12.25 25.863v75.439a2.75 2.75 0 0 0 3.55 2.631l28.297-8.6a3.25 3.25 0 0 1 2.001.036l23.33 8.015c2.659.913 5.569.749 8.107-.457l26.362-12.526a6.75 6.75 0 0 0 3.853-6.096V18.61a2.75 2.75 0 0 0-3.476-2.652L77.21 23.364a3.25 3.25 0 0 1-1.89-.052l-26.842-8.979a10.75 10.75 0 0 0-6.724-.031l-27.602 8.945a2.75 2.75 0 0 0-1.902 2.616Z"}))),h.createElement("mask",{id:"icon-map-no-result_svg__d",width:94,height:90,x:12,y:14,maskUnits:"userSpaceOnUse",style:{maskType:"alpha"}},l||(l=h.createElement("path",{fill:"#D9D9D9",d:"M12 101.302v-75.44a2 2 0 0 1 1.383-1.902l28.855-9.35a6 6 0 0 1 3.753.017l28.668 9.589a2 2 0 0 0 1.162.032l27.651-7.566a2 2 0 0 1 2.528 1.93v66.584a6 6 0 0 1-3.559 5.481l-27.754 12.362a5.998 5.998 0 0 1-4.391.194L44.73 94.449a2 2 0 0 0-1.232-.022l-28.916 8.788A2 2 0 0 1 12 101.302Z"}))),n||(n=h.createElement("g",{mask:"url(#icon-map-no-result_svg__d)"},h.createElement("path",{fill:"#9CA3AF",d:"M73.212 3.274v121.193a7.81 7.81 0 0 1-4.8.164l-23.797-6.799-.033-.009V-4.667c.496.041.99.13 1.473.267l27.084 7.654.073.02Z",opacity:.15}),h.createElement("g",{opacity:.4},h.createElement("path",{fill:"#D0D3D7",d:"M70 49 48 8h44.5v25.5L70 49Z"}),h.createElement("path",{fill:"#D0D3D7",d:"M29 45C24.5 47.167 8.4 57.2 6 58v34.5L43 67 29 45Z",opacity:.3}),h.createElement("path",{stroke:"#fff",strokeLinejoin:"round",strokeWidth:6,d:"M8.5 15 72 109m21-74.5L-3.5 98M93 34.5V11m0 23.5L119 62M44.5 4.5l24.5 44M-1 62l29.766-17"})))),o||(o=h.createElement("g",{strokeWidth:6,filter:"url(#icon-map-no-result_svg__e)"},h.createElement("circle",{cx:87.5,cy:82.5,r:18.5,fill:"url(#icon-map-no-result_svg__f)",stroke:"url(#icon-map-no-result_svg__g)"}),h.createElement("path",{stroke:"#D7D9DB",strokeLinecap:"round",d:"M110.5 106.801 100.699 97"}))),c||(c=h.createElement("defs",null,h.createElement("linearGradient",{id:"icon-map-no-result_svg__b",x1:33.753,x2:81.367,y1:13,y2:102.837,gradientUnits:"userSpaceOnUse"},h.createElement("stop",{stopColor:"#F3F4F6"}),h.createElement("stop",{offset:.5,stopColor:"#E0E3E7"}),h.createElement("stop",{offset:1,stopColor:"#EAECEE"})),h.createElement("linearGradient",{id:"icon-map-no-result_svg__c",x1:28.555,x2:88.696,y1:13,y2:106.986,gradientUnits:"userSpaceOnUse"},h.createElement("stop",{stopColor:"#F0F2F4"}),h.createElement("stop",{offset:.661,stopColor:"#E5E7E9"}),h.createElement("stop",{offset:1,stopColor:"#E3E5E8"})),h.createElement("linearGradient",{id:"icon-map-no-result_svg__f",x1:75.5,x2:98.5,y1:66.5,y2:101,gradientUnits:"userSpaceOnUse"},h.createElement("stop",{stopColor:"#fff",stopOpacity:.7}),h.createElement("stop",{offset:1,stopColor:"#F7F8FA",stopOpacity:.7}),h.createElement("stop",{offset:1,stopColor:"#fff",stopOpacity:0})),h.createElement("linearGradient",{id:"icon-map-no-result_svg__g",x1:78.5,x2:98.5,y1:64,y2:97.5,gradientUnits:"userSpaceOnUse"},h.createElement("stop",{stopColor:"#DCDDDE"}),h.createElement("stop",{offset:.385,stopColor:"#CFD2D6"}),h.createElement("stop",{offset:1,stopColor:"#D7D9DA"})),h.createElement("filter",{id:"icon-map-no-result_svg__a",width:97,height:92.776,x:11.5,y:13.028,colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse"},h.createElement("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),h.createElement("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),h.createElement("feOffset",{dy:1}),h.createElement("feComposite",{in2:"hardAlpha",operator:"out"}),h.createElement("feColorMatrix",{values:"0 0 0 0 0.713726 0 0 0 0 0.72549 0 0 0 0 0.74902 0 0 0 0.8 0"}),h.createElement("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_35220_40989"}),h.createElement("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_35220_40989",result:"shape"})),h.createElement("filter",{id:"icon-map-no-result_svg__e",width:47.5,height:49.801,x:66,y:61,colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse"},h.createElement("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),h.createElement("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),h.createElement("feOffset",{dy:1}),h.createElement("feComposite",{in2:"hardAlpha",operator:"out"}),h.createElement("feColorMatrix",{values:"0 0 0 0 0.713726 0 0 0 0 0.72549 0 0 0 0 0.74902 0 0 0 0.8 0"}),h.createElement("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_35220_40989"}),h.createElement("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_35220_40989",result:"shape"})))))};let _=e=>{let{centerCoord:t,onClose:r,onConfirm:a}=e,{target:l}=(0,h.useContext)(E.I),[n,o]=(0,h.useState)(!1),[c,s]=(0,h.useState)(""),[i,u]=(0,h.useState)([]),f=(0,h.useRef)(null),d=(0,h.useRef)(null),[p,g]=(0,h.useState)(!1),v="after:tw-absolute after:tw-left-0 after:tw-top-0 after:tw-h-full after:tw-w-full after:tw-rounded-md after:tw-bg-gray-2 after:tw-animate-light after:tw-bg-light after:tw-bg-400",{IconCloseCircleSolid:y,IconSearchOutline:_,IconArrowChevronRightOutline:b,IconMapPinOutline:C}=(0,m.u)();(0,h.useEffect)(()=>{d.current&&setTimeout(()=>{var e;null===(e=d.current)||void 0===e||e.focus()},300)},[]);let k=()=>(0,m._)(void 0,void 0,void 0,function*(){p&&g(!1),o(!0);try{let e={types:"poi,address",limit:10};t&&(e.proximity="".concat(t.lng,",").concat(t.lat));let r=yield(0,m.n)(c,e);if(r.features)r.features.length||g(!0),u(r.features.map(e=>Object.assign(Object.assign({},e),{placeName:e.place_name})));else throw Error("mapbox search error")}catch(e){g(!0),u([])}finally{o(!1)}});return h.createElement(E.Z,{className:(0,m.m)("tw-z-10",{"tw-bg-gray-0":!!l})},h.createElement(m.H,{backDisabled:!0,onClose:r}),h.createElement("div",{className:"tw-px-6"},h.createElement("div",{className:"tw-relative tw-flex tw-w-full tw-items-center tw-rounded-lg after:tw-rounded-lg tw-inner-border after:tw-border-gray-4 tw-p-4 tw-shadow-light focus-within:after:tw-border-theme-default focus-within:after:tw-border-2"},h.createElement("div",{className:"tw-flex"},h.createElement(_,{className:"tw-me-3 tw-h-5 tw-w-5 tw-text-gray-5"})),h.createElement("input",{ref:d,className:"tw-w-full !tw-p-0 tw-text-16 tw-h-6 tw-font-400 focus:tw-outline-none focus-within:tw-outline-none tw-text-gray-7 tw-border-none",type:"text",value:c,onChange:e=>s(e.target.value),placeholder:w.Z.format("modules.mapbox.placeholder"),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),k())}}),h.createElement("div",{className:"tw-flex tw-ms-2 tw-icon-dark tw-cursor-pointer",onClick:()=>{s(""),u([])}},h.createElement(y,{className:(0,m.m)("tw-w-5 tw-h-5 ",{"tw-opacity-0":!c})}))),h.createElement("p",{className:"tw-relative tw-my-6 tw-mb-3 tw-w-max tw-text-14 tw-font-500 tw-capitalize tw-text-gray-7 ".concat(n?v:"")},(i.length>0||p||n)&&w.Z.format("modules.search.result"))),h.createElement("div",{className:"tw-px-6 tw-overflow-y-scroll tw-h-[calc(100%-8rem)] tw-webkit-scrollbar tw-pb-15",ref:f},h.createElement("div",{className:"-tw-mr-1.5 firefox:tw-mr-0 ios:tw-mr-0"},n&&h.createElement("div",{className:"tw-mt-0.5"},[,,,,,].fill(0).map((e,t)=>h.createElement("div",{className:"tw-relative tw-mb-3 tw-flex tw-h-max tw-w-full tw-items-center",key:t},h.createElement("div",{className:"tw-relative tw-flex tw-w-full tw-h-16 ".concat(v)})))),p&&h.createElement("div",{className:"tw-absolute tw-top-1/2 tw-left-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2 tw-text-center"},h.createElement(x,{className:"tw-flex tw-h-30 tw-w-30"}),h.createElement("div",{className:"tw-text-gray-5 tw-text-14-regular tw-text-center tw-mt-2"},w.Z.format("modules.search.error"))),i.length>0&&!n&&h.createElement(h.Fragment,null,i.map(e=>{let t=e.placeName.split(", "),r=(0,m.o)(e.center,{symbol:"/"});return h.createElement("div",{key:e.id,className:"tw-relative tw-inner-border after:tw-border-gray-4 after:tw-rounded-lg tw-flex tw-items-center tw-p-3 tw-mb-3 last:tw-mb-0 tw-cursor-pointer",onClick:()=>a(e)},h.createElement(C,{className:"tw-me-3 tw-w-6 tw-h-6 tw-text-gray-6"}),h.createElement("div",{className:"tw-w-[calc(100%-4.75rem)]"},h.createElement("div",{className:"tw-text-14-medium tw-font-500 tw-truncate tw-text-gray-7"},e.text),h.createElement("div",{className:"tw-text-12-regular tw-truncate tw-text-gray-6"},t[t.length-1],",",r)),h.createElement(b,{className:"tw-ms-5 tw-w-5 tw-h-5 tw-text-gray-6"}))})))))};function b(){return(b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var C=function(e){return h.createElement("svg",b({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 48 48"},e),s||(s=h.createElement("g",{clipPath:"url(#icon-marker_svg__a)"},h.createElement("g",{filter:"url(#icon-marker_svg__b)"},h.createElement("circle",{cx:24,cy:23,r:14,fill:"#fff"})),h.createElement("circle",{cx:24,cy:23,r:11,fill:"#3B82F6",opacity:.9}),h.createElement("circle",{cx:24,cy:23,r:9,fill:"#3B82F6"}))),i||(i=h.createElement("defs",null,h.createElement("clipPath",{id:"icon-marker_svg__a"},h.createElement("path",{fill:"#fff",d:"M0 0h48v48H0z"})),h.createElement("filter",{id:"icon-marker_svg__b",width:44,height:44,x:2,y:9,colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse"},h.createElement("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),h.createElement("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),h.createElement("feMorphology",{in:"SourceAlpha",radius:2,result:"effect1_dropShadow_29069_123708"}),h.createElement("feOffset",{dy:8}),h.createElement("feGaussianBlur",{stdDeviation:5}),h.createElement("feComposite",{in2:"hardAlpha",operator:"out"}),h.createElement("feColorMatrix",{values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0"}),h.createElement("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_29069_123708"}),h.createElement("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_29069_123708",result:"shape"})))))},k={locationAutoRotate:"location-auto-rotate-GpI7i",plane:"plane-4AwWH",cloudAni:"cloud-ani-fGFli",marker:"marker-YbsRC"};let N=(0,m.g)("/client/image/cloud.png"),S=(0,h.forwardRef)((e,t)=>{var r;let{enableLocation:a=!1,mapOption:l,defaultPosition:n,onChange:o}=e,[c,s]=(0,h.useState)(),[i,g]=(0,h.useState)(!1),[E,y]=(0,h.useState)(!1),[x,b]=(0,h.useState)(!1),S=(0,h.useRef)(null),O=(0,h.useRef)(null),D=(0,h.useRef)(),F=(0,h.useRef)((0,u.Z)()),M=(0,h.useRef)(null),A=(0,h.useRef)(null),[B,Z]=(0,h.useState)(!0),{IconLocalOutline:L,IconSearchOutline:R,IconArrowsPointingInOutline:U}=(0,m.u)(),j=()=>(0,m._)(void 0,void 0,void 0,function*(){if(!c||!D.current||E)return{};let e=D.current.getCenter(),t=c.placeName.split(", "),r=t[t.length-2].split(" ");r.pop();let a=document.createElement("canvas"),n=D.current.getCanvas();a.width=Math.max(l.width,1),a.height=Math.max(l.height,1),a.getContext("2d").drawImage(n,0,0,a.width,a.height);let o=yield(0,f.Z)(a);return{image:d.Z.create(o),place:c.text,country:t[t.length-1],province:r.join(" "),city:t[t.length-3],value:(0,m.o)([e.lng,e.lat])}});(0,h.useEffect)(()=>{j().then(e=>null==o?void 0:o(e))},[c,E]),(0,h.useImperativeHandle)(t,()=>({confirm:()=>(0,m._)(void 0,void 0,void 0,function*(){if(E)throw Error("MapboxFlyingError");return j()})})),(0,h.useEffect)(()=>{if(a?z(!0):G(n.center),O.current){let{zoom:e=12,style:t}=l;v().accessToken=m.p,D.current=new(v()).Map({container:O.current,style:t,center:n.center,zoom:e<0?0:e>24?24:e,dragPan:!0,pitchWithRotate:!1,preserveDrawingBuffer:!0,doubleClickZoom:!1,minZoom:2}),D.current.on("click",e=>I(e.lngLat)),D.current.on("dataloading",()=>y(!0)),D.current.on("idle",()=>{y(!1)}),D.current.on("zoomend",()=>(0,m._)(void 0,void 0,void 0,function*(){G(D.current.getCenter())})),D.current.on("dragend",()=>(0,m._)(void 0,void 0,void 0,function*(){G(D.current.getCenter())}))}return()=>{var e;null===(e=D.current)||void 0===e||e.remove()}},[l,n,a]);let I=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{search:!0};if(!D.current)return;F.current=(0,u.Z)(),y(!0);let r={center:e},{hasDuration:a,search:l=!0}=t;l&&G(e),a&&(r.duration=a),D.current.flyTo(r)},G=e=>(0,m._)(void 0,void 0,void 0,function*(){g(!0);let t=(yield(0,m.q)(e)).features[0];t&&s(Object.assign(Object.assign({},t),{placeName:t.place_name})),g(!1)}),z=e=>(0,m._)(void 0,void 0,void 0,function*(){let t;let r=F.current;try{if(E)return;y(!0);let e=yield(0,m.t)();t={lat:e.coords.latitude,lng:e.coords.longitude}}catch(r){console.log(r),e?t=n.center:y(!1)}finally{if(r!==F.current){y(!1);return}t&&I(t,{hasDuration:3e3})}});function P(){if(!S.current||!M.current)return;let[e,t,r,a]=(0,m.v)(S.current,M.current,200),l=180/Math.PI*Math.atan2(a-t,r-e);M.current.classList.add("tw-opacity-100"),(0,m.w)({startX:e,startY:t,targetX:r,targetY:a,angle:l+40,target:M.current,duration:3e4},()=>{var e;null===(e=M.current)||void 0===e||e.classList.remove("tw-opacity-100"),(0,p.Z)(15e3).then(P)})}(0,h.useEffect)(()=>{(0,p.Z)(15e3).then(P)},[]),(0,h.useEffect)(()=>{var e;null===(e=A.current)||void 0===e||e.addEventListener("animationend",()=>{var e;null===(e=A.current)||void 0===e||e.classList.remove(k.cloudAni),(0,p.Z)(1e4).then(()=>{var e;return null===(e=A.current)||void 0===e?void 0:e.classList.add(k.cloudAni)})})},[A.current]);let W="tw-flex tw-bg-gray-0 tw-items-center tw-justify-center tw-w-9 tw-h-9 tw-cursor-pointer tw-rounded-lg tw-shadow-medium";return h.createElement("div",{className:(0,m.m)("tw-relative tw-w-full tw-h-full")},h.createElement("div",{ref:S,className:(0,m.m)("tw-relative tw-w-full tw-h-full",{"tw-inner-border after:tw-border-theme-default after:tw-rounded-lg tw-shadow-dark":!B})},h.createElement("div",{ref:O,className:"tw-w-full tw-h-full"}),h.createElement("div",{className:" tw-absolute tw-end-3 not-inset-end:tw-right-3 tw-bottom-3 tw-flex tw-z-[2]"},h.createElement("div",{className:(0,m.m)(W,"tw-me-2",{"tw-bg-theme-default":!B}),onClick:()=>Z(!B)},h.createElement(U,{className:(0,m.m)("tw-w-5 tw-h-5 tw-text-gray-6",{"tw-text-gray-0":!B})})),h.createElement("div",{className:(0,m.m)(W),onClick:()=>{z(!1)}},h.createElement(L,{className:(0,m.m)("tw-w-5 tw-h-5 tw-text-gray-6",{[k.locationAutoRotate]:E||i})}))),h.createElement("div",{className:(0,m.m)("tw-absolute tw-z-[2] tw-left-3 tw-right-3 tw-top-3 tw-flex tw-items-center tw-h-14 tw-px-3 tw-inner-border","after:tw-border-gray-4 after:tw-bg-gray-0 after:tw-rounded-lg tw-shadow-light tw-cursor-pointer"),onClick:()=>b(!0)},h.createElement(R,{className:"tw-w-5 tw-h-5 tw-z-[1] tw-text-gray-5"}),h.createElement("div",{className:(0,m.m)("tw-flex-1 tw-ms-3 tw-z-[1] tw-text-gray-5 tw-text-14-regular tw-truncate",{"tw-text-gray-7":c})},c?c.text:w.Z.format("modules.mapbox.placeholder"))),h.createElement("div",{className:(0,m.m)(k.marker,"tw-absolute tw-flex tw-left-1/2 tw-top-1/2 -tw-translate-x-1/2 -tw-translate-y-1/2 after:tw-absolute after:tw-w-20 after:tw-h-20 after:tw-left-1/2 after:-tw-translate-x-1/2 after:tw-top-1/2 after:-tw-translate-y-1/2 after:tw-rounded-full after:tw-bg-gray-alpha-8")},h.createElement(C,{className:"tw-w-12 tw-h-12"})),h.createElement("div",{ref:M,className:(0,m.m)(k.plane,"tw-select-none tw-opacity-0")},"✈️"),h.createElement("img",{className:(0,m.m)(k.cloudAni,"tw-absolute tw-left-0 tw-top-1/2 tw-pointer-events-none -tw-translate-x-full -tw-translate-y-1/2 tw-w-[80%] tw-h-auto"),src:N,ref:A,alt:""}),B&&h.createElement("div",{className:"tw-absolute tw-left-0 tw-right-0 tw-bottom-0 tw-top-0 tw-z-[1]"})),x&&h.createElement(_,{centerCoord:null===(r=D.current)||void 0===r?void 0:r.getCenter(),onClose:()=>b(!1),onConfirm:e=>{s(e),b(!1),I(e.center,{hasDuration:3e3,search:!1})}}))})}}]);