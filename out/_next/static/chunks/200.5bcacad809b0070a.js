"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[200],{65200:function(e,r,t){t.r(r),t.d(r,{default:function(){return w}});var n=t(12648),o=t(1853),l=t(35038),i=t(69668),c=t(77221),u=t(33092),a=t(244),f=t(45356),d=t(62463),s=t(84021),h=t(74847);t(74964),t(2826),t(62808),t(15746),t(875),t(93932),t(6004),t(91101),t(32489),t(69537),t(6096);let v=[{id:n.M.Silver,shadowColor:"#21252D",background:new f.fabric.Gradient({type:"linear",coords:{x1:0,y1:0,x2:0,y2:1},gradientUnits:"percentage",colorStops:[{offset:.1309,color:"#585E66"},{offset:.9921,color:"#3C3F44"}]}),texture:(0,n.g)("/client/image/silver.png")},{id:n.M.Gold,shadowColor:"#2D191A",background:new f.fabric.Gradient({type:"linear",coords:{x1:0,y1:0,x2:0,y2:1},gradientUnits:"percentage",colorStops:[{offset:0,color:"#685F3E"},{offset:1,color:"#49432D"}]}),texture:(0,n.g)("/client/image/gold.png")},{id:n.M.RoseGold,shadowColor:"#21252D",background:new f.fabric.Gradient({type:"linear",coords:{x1:0,y1:0,x2:0,y2:1},gradientUnits:"percentage",colorStops:[{offset:0,color:"#6A5B53"},{offset:.8194,color:"#4F3E35"}]}),texture:(0,n.g)("/client/image/rose-gold.png")}],g=(0,a.forwardRef)((e,r)=>{let{value:t="",material:g,font:w,env:b,onLoaded:p,onLoadingChange:m,onChange:x}=e,{background:y,shadowColor:E,texture:R}=(0,a.useMemo)(()=>v.find(e=>e.id===g),[g]),S=(0,a.useRef)(null),k=(0,a.useRef)(null),C=(0,a.useRef)(),M=(0,a.useRef)(),_=(0,a.useRef)(),G=(0,a.useRef)(w),Y=(0,h.u)(),A=()=>(0,n._)(void 0,void 0,void 0,function*(){var e,r,t,n;let o=new f.fabric.Rect({width:null===(e=C.current)||void 0===e?void 0:e.getWidth(),height:null===(r=C.current)||void 0===r?void 0:r.getHeight(),fill:y});o.sendToBack(),null===(t=C.current)||void 0===t||t.add(o),null===(n=C.current)||void 0===n||n.renderAll()}),P=()=>(0,n._)(void 0,void 0,void 0,function*(){var e,r,n;M.current=void 0,null===(e=C.current)||void 0===e||e.clear();let i=(0,d.cv)(G.current);yield(0,o.Z)({url:G.current,name:i}),_.current=new f.fabric.IText(t,{fontFamily:i,lineHeight:1.2,fontSize:50,textAlign:"center",originX:"center",originY:"center",objectCaching:!1,shadow:new f.fabric.Shadow({color:E,offsetX:1,offsetY:1,blur:0})});let c=yield l.I.loadImage(R),u=new f.fabric.Pattern({source:c,offsetY:-(c.height-(null!==(r=_.current.height)&&void 0!==r?r:0))/2}),a=[1.5,2,2.5,3,3.5,4].map(e=>{let r=f.fabric.util.object.clone(_.current);return r.set({shadow:new f.fabric.Shadow({color:E,offsetX:e,offsetY:e,blur:0})}),r}),s=f.fabric.util.object.clone(_.current);s.set({shadow:new f.fabric.Shadow({color:"#fff",offsetX:-.5,offsetY:-.5,blur:0}),left:0,top:0}),_.current.fill=u,s.fill=u,M.current=new f.fabric.Group([...a,_.current,s],{left:C.current.getWidth()/2,top:C.current.getHeight()/2,originX:"center",originY:"center"}),null===(n=C.current)||void 0===n||n.add(M.current),T()});(0,a.useEffect)(()=>{if(!S.current)return;let{clientHeight:e,clientWidth:r}=S.current;return C.current=new f.fabric.StaticCanvas(k.current,{height:e,width:r}),Promise.all([P(),A()]).then(()=>{null==p||p(),w!==G.current&&X()}).catch(()=>Y("PreviewMetalTextRenderError")).finally(()=>{null==m||m(!1)}),()=>{C.current&&(n.h.revoke(C.current,!1),C.current=void 0)}},[]);let T=()=>{var e,r,t;if(!_.current)return;let n=C.current.getWidth()-32,o=_.current.getMeasuringContext(),l=o.font.split(" ")[1];o.font="".concat(50,"px '").concat(l,"'"),o.textBaseline="top";let{actualBoundingBoxLeft:c,actualBoundingBoxRight:u,actualBoundingBoxAscent:a,actualBoundingBoxDescent:f}=o.measureText(null!==(e=_.current.text)&&void 0!==e?e:""),d=(c=Math.ceil(c))+(u=Math.ceil(u)),s=(0,i.Z)({width:d,height:a+f},{width:n,height:50});null===(r=M.current)||void 0===r||r.scale(s),null===(t=C.current)||void 0===t||t.renderAll()},X=()=>(0,n._)(void 0,void 0,void 0,function*(){null==m||m(!0),yield Promise.all([P(),A()]).catch(()=>Y("PreviewMetalTextRenderError")).finally(()=>{null==m||m(!1)})});(0,a.useEffect)(()=>{M.current&&X()},[g]),(0,a.useEffect)(()=>{G.current=w,M.current&&X()},[w]),(0,s.Z)(()=>{var e;null===(e=M.current)||void 0===e||e.forEachObject(e=>{e.set({text:t})}),T(),Z().then(e=>null==x?void 0:x({image:e})).catch(()=>{null==x||x({})})},[t],{wait:200});let Z=()=>(0,n._)(void 0,void 0,void 0,function*(){if(C.current)return(0,c.Z)(C.current.getElement()).then(u.Z.create)});return(0,a.useImperativeHandle)(r,()=>({confirm:Z})),a.createElement("div",{ref:S,className:"tw-w-full tw-h-full"},a.createElement("canvas",{ref:k}))});var w=(0,a.memo)(g)},74847:function(e,r,t){t.d(r,{u:function(){return o}});var n=t(244);let o=()=>{let[,e]=(0,n.useState)();return r=>{e(()=>{throw Error(r)})}}}}]);